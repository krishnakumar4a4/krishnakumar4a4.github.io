<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>
  
     Be on your best Erlang behavior | 
    Krishna Kumar T
  
</title><meta name="description" content="Be on your best Erlang behavior"><meta name="author" content="Krishna Kumar Thokala">

<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/favicon-32x32.png " sizes="32x32" type="image/png">
<link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0c344b">
<link rel="icon" href="/favicon.ico">


    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism-okaidia.min.css">
    



    
        
            <link rel="stylesheet" href="/dist/main.37ab3f61b95417873748.min.css">
        
    




<link rel="canonical" href="https://krishnakumar4a4.github.io/post/be-on-your-best-erlang-behavior/"><meta property="og:title" content="Be on your best Erlang behavior" />
<meta property="og:description" content="Be on your best Erlang behavior" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://krishnakumar4a4.github.io/post/be-on-your-best-erlang-behavior/" /><meta property="og:image" content="https://krishnakumar4a4.github.io/images/gen_fsm_erlang.jpeg" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-04-01T09:43:12+05:30" />
<meta property="article:modified_time" content="2017-04-01T09:43:12+05:30" />
<meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/speakup-announcement/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/comparision-erlang-and-rust/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/simplifying-erlang-beam/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/react-redux-erlang-analogy/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/know-why-you-may-choose-erlang/" />

<meta itemprop="name" content="Be on your best Erlang behavior">
<meta itemprop="description" content="Be on your best Erlang behavior"><meta itemprop="datePublished" content="2017-04-01T09:43:12+05:30" />
<meta itemprop="dateModified" content="2017-04-01T09:43:12+05:30" />
<meta itemprop="wordCount" content="1290"><meta itemprop="image" content="https://krishnakumar4a4.github.io/images/gen_fsm_erlang.jpeg">
<meta itemprop="keywords" content="erlang," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://krishnakumar4a4.github.io/images/gen_fsm_erlang.jpeg"/>

<meta name="twitter:title" content="Be on your best Erlang behavior"/>
<meta name="twitter:description" content="Be on your best Erlang behavior"/>

</head>
<body>
    
<nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id="navbar-main-menu">
    <div class="container">
        <a class="navbar-brand font-weight-bold" href="https://krishnakumar4a4.github.io">Krishna Kumar T</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="main-menu">
            <ul class="navbar-nav ml-auto">
                
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/notion/">Notion</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/post/">Posts</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/projects/">Projects</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/pictures/">Pictures</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/bookmarks/">Bookmarks</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/tweets/">Tweets</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/linkedin/">LinkedIn</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/team/">Team</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/tags/">Tags</a></li>
                
            
            </ul>
        </div>
    </div>
</nav>


    
<main class="content-page container pt-7 pb-5">
    
    <div class="row">
        <div class="col">
            <article>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="meta text-muted mb-3">
                            <p class="created text-muted text-uppercase font-weight-bold mb-1">April 1, 2017</p>
                            <span class="mr-2"><i class="fas fa-book-open mr-2"></i>1290 words</span>
                            <span><i class="fas fa-clock mr-2"></i>7 mins read</span>
                        </div>

                        <h1>Be on your best Erlang behavior</h1>

                        <ul class="authors list-inline"><li class="list-inline-item mr-3">
                    <div class="media author"><a href="/authors/krishna-kumar-thokala/" class="mr-3">
                                    <picture>
                                        <source srcset="/authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_64x0_resize_box_3.png 1x, /authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_128x0_resize_q100_box_3.png 2x, /authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_192x0_resize_q100_box_3.png 3x">
                                        <img src="/authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_64x0_resize_box_3.png" class="rounded-circle" alt="Krishna Kumar Thokala">
                                    </picture>
                                </a><div class="media-body">
                            <h5 class="name my-0"><a href="/authors/krishna-kumar-thokala/" class="small">Krishna Kumar Thokala</a>
                            </h5><p class="social small text-muted">
                                    <a href="https://twitter.com/@krishnakumart36">@KrishnaKumarT36</a>
                                </p></div>
                    </div>
                </li></ul>
                    </div>
                </div><div class="row justify-content-center mb-3">
                                <div class="col-lg-10">
                                    <img data-src="/images/gen_fsm_erlang_hu3c6d821423668d296ab688d77730e1b4_33138_900x500_fit_q75_box.jpeg" class="img-fluid rounded mx-auto d-block" alt="Be on your best Erlang behavior">
                                </div>
                            </div><div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="content">
                            <p>I had a great session with my team on Erlang behaviors and thought it would be worth blogging it. I have got chance to explain them about available erlang behaviors and how to choose and use them.</p>
<p>1.gen_supervisor
2.gen_server
3.gen_event
4.gen_fsm</p>
<p>When you want to employ a behavior in your applications, you should have a basic understanding of the below two types of functions.</p>
<ol>
<li>API → Exposed to the user for external control and to send events.</li>
<li>Callback functions → API is a action and corresponding Callback functions produce reactions.</li>
</ol>
<h4 id="api">API:</h4>
<p>For every behavior, there would be set of API’s, commonly <em><strong>start, start_link, call,send_event</strong></em> etc which will be calling the behavior modules and they in turn try to callback functions in the registered module.</p>
<p>The initial start or start_link API’s are responsible for calling the callback function init which is used for initialization of the behaviors to set default values.</p>
<h4 id="callback-functions">Callback functions:</h4>
<p>API and callback functions exist in pairs i.e for every API called, there should be an equivalent callback function which does the reaction and these callback functions needs to be defined in the same module(with tag <em><strong>-behavior(gen_<!-- raw HTML omitted -->)</strong></em>) as the behavior.</p>
<blockquote>
<p>Eg: Let us take gen_server as an example:
Start gen_server by calling start or start_link API.
You call gen_server:start API → reaches gen_server module → calls the callback function “<!-- raw HTML omitted -->:init”.
Call an event on the gen_server.
You call gen_server:call API → reaches gen_server module → calls the callback function “<!-- raw HTML omitted -->:handle_call”.</p>
</blockquote>
<hr>
<h4 id="gen_supervisor">gen_supervisor:</h4>
<p>From bottom-up approach,Imagine employees in an organization managed by scrum masters, scrum masters are managed by product owners and so on up to the CEO.</p>
<p>When we talk from top-down, CEO is sitting at the top level and he will be called from the top level supervisor. Under him, there can be multiple supervisors and each supervisor will have some more supervisors or employees working under them. If some employee or Supervisor at some level resigns or leaves, his/her immediate supervisor should take action to fill the position to ensure workload balance.</p>
<p>Supervisors are employed exactly for the same purpose. supervisor and child flags decide this behavior:
if supervisor flags are given a restart_period as 3 and restart_intensity as 100, the supervisor will understand to stop restarting the child process if the process is trying to restart more than 100 times in 3 seconds.</p>
<p>There is also some control with child flags i.e If shutdown =1000, supervisor will not restart it if child takes more than 1000ms to start.</p>
<p>If restart_type is permanent, child will always be restarted or if it is temporary, child will never be restarted or if it is transient, child will only be restarted if killed by a non normal signal.</p>
<p>Remember that supervisor flags will always dominate child flags.</p>
<blockquote>
<p>Eg: Let us say a company is rolling out a new feature/update for its apps only to a select customers. Unfortunately, a bug was found which constantly bombard the server with connection requests. It is never good on the server side to engage such unworthy behavior. Hence supervisor stops restarting it if the restarts are too frequent. These values should be carefully adjusted based on your server capacity.</p>
</blockquote>
<h4 id="gen_server">gen_server:</h4>
<p>The next big generic and often used behavior in Erlang is gen_server. In simple words, it is a constantly listening process with a simple in-memory database called state. It is meant to continuously listen for synchronous or asynchronous incoming traffic and respond accordingly.</p>
<p>Like any other behavior, it starts with a start or start_link API which in turn calls the callback function init which fills up default state.</p>
<p>It has a synchronous API called “call” and an asynchronous API “cast”. The first one is expected to give a response back which is not the case for second one.</p>
<blockquote>
<p>Eg: Let us take an example scenario where you want employ gen_server for electronic voting machine. Each and every “call” will increment the vote count by one and gives back response to let the voters know whether the vote was successfully casted or not. Of course, there is a privilege where you can prevent users from the acknowledgement by using “cast” API instead of “call”,only if you believe the system is highly reliable and a vote cast may never fail and you don’t want users to perform a synchronous blocking call to handle large simultaneous vote casts.</p>
</blockquote>
<h4 id="gen_event">gen_event:</h4>
<p>Imagine you are trying to create a platform which is expected to add more and more features in the future.
Let us say you own a payment gateway that would accept payment requests from multiple domains like mobile prepaid recharge, online shopping, ticket vending etc. As more and more domains are added, your backend has to support them.</p>
<p>Gen_event behavior helps you here, it starts an event Manager process that can handle multiple kinds of events like prepaid recharge payment, ticket payment etc. We write handlers for each type of payment and add these handlers to the main event Manager process. The event Manager is like a large black-hole that assimilate in all kinds of events and broadcasts them to the event handlers. Whichever event handler matches the incoming event pattern would process the event and rest of them are discarded. Like this, you can dynamically add/remove new event handlers when your payment gateway has to support new payment domain.</p>
<blockquote>
<p><em><strong>start</strong></em> and <em><strong>start_link</strong></em> are two API’s which would call the callback function “init” for initialization of the event Manager. <em><strong>gen_event:notify</strong></em> is an API to send events to the event Manager and that event is broadcasted to all the event handlers. add_handler API is used to add new handler to the existing event Manager whereas <em><strong>delete_handler</strong></em> can be used to delete deprecated handlers.</p>
</blockquote>
<blockquote>
<p>Remember, apart from “init” callback function for the event Manager, an “init” callback for each handler would also be called when add_handler API is triggered.</p>
</blockquote>
<h4 id="gen_fsm">gen_fsm:</h4>
<p>Imagine you have to make application that runs a elevator. An elevator is also a state machine with 4 states i.e going up,going down,floor stop and emergency stop.</p>
<figure class="figure">
    <a href="/images/gen_fsm_erlang.jpeg" class="d-block" data-toggle="lightbox" data-gallery="post-gallery">
        <img src="/images/gen_fsm_erlang.jpeg"class="figure-img img-fluid"
        /> 
    </a>
</figure>

<p>Start a gen_fsm process with 2 empty queues inside the state. One queue(main) stores the floor numbers for the current running state i.e either going down/up and other queue(auxiliary) stores them for immediate other state i.e going up/down.</p>
<p>Let me explain, if you are going UP, all the key presses above the current floor will be stored in the main queue and those floor numbers are popped out one by one when the elevator reaches the numbered floor. In the meanwhile,if someone presses a lower numbered floor, the second(auxiliary) queue will be responsible for storing these numbers. When the elevator reaches the maximum numbered floor, it will load the auxiliary queue to the main queue and starts moving down.Apart from the above mentioned states, other two states are floor open(closes after a timeout)and emergency stop(stops and door stays open).</p>
<p>When the elevator is started, it waits for the key press in the current floor(floor open state). If the key pressed is higher than current floor, It starts moving UP(Going UP state) and all the upward key presses stored in the current running queue. During this time, if someone presses a lower numbered floor, it is stored in a auxiliary queue for the next state(Going DOWN state). While the elevator is operating normally, you can also perform an emergency STOP(emergency stop state) that stops it and releases the door lock.</p>
<h4 id="implementation">Implementation:</h4>
<blockquote>
<p>All the individual floor number key presses call a <em><strong>gen_fsm:send_event</strong></em> function that is handled by corresponding state.</p>
</blockquote>
<blockquote>
<p>Whereas, emergency stop is special case that should be handled irrespective of the current state of the elevator. In such cases, we use <em><strong>gen_fsm:send_all_state_event</strong></em> function that is handled by a unique callback function that can alter the state of the fsm making it to halt.</p>
</blockquote>

                        </div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href="/tags/erlang">
                                    <i class="fas fa-tag mr-2"></i>erlang
                                </a></div><ul class="share nav my-3 justify-content-end">
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbe-on-your-best-erlang-behavior%2f&text=Be%20on%20your%20best%20Erlang%20behavior">
              <i class="fa-fw fab fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbe-on-your-best-erlang-behavior%2f&title=Be%20on%20your%20best%20Erlang%20behavior">
                <i class="fa-fw fab fa-linkedin-in"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbe-on-your-best-erlang-behavior%2f&t=Be%20on%20your%20best%20Erlang%20behavior">
                <i class="fa-fw fab fa-facebook-f"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://reddit.com/submit?url=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbe-on-your-best-erlang-behavior%2f&title=Be%20on%20your%20best%20Erlang%20behavior">
                <i class="fa-fw fab fa-reddit-alien"></i>
            </a>
        </li>
    </nav>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        
                    </div>
                </div><div class="row justify-content-center my-3">
                    <div class="col-lg-8">
                        <div id="commento"></div>
                        <script src="https://commento.io"></script>
                    </div>
                </div></article>
        </div>
    </div>

    <div class="related-content row mt-5 row-cols-1 row-cols-lg-3"><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/post/know-why-you-may-choose-erlang/" class="d-block"><div class="card-body">
            <h4 class="card-title">Know why you may choose Erlang</h4>
            <p class="card-text text-muted text-uppercase">April 1, 2017</p>
            <div class="card-text">
                When you have good understanding on Erlang, you will inherently start to see other applications differently.
 You will have tendency to ask questions like what is the scalability? What is the uptime? How easy is the code upgrade? How much availability can be guaranteed? Would the choice of database can match the speed of your application? How easy is to make your application distributed? Most of all, Can it crash fast and recover fast?
            </div>
        </div>
    </a>
</div>

            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/post/million-event-erlang-engine/" class="d-block"><div class="card-body">
            <h4 class="card-title">Million event Erlang “like” engine</h4>
            <p class="card-text text-muted text-uppercase">December 7, 2016</p>
            <div class="card-text">
                Inspiration: Facebook has a very unique and custom architecture to handle millions of likes on its posts every second. Sometimes a post is so catchy that it will attract millions of likes per second and being a fan of that article you don’t want to miss its live statistics.
Shorten the goal: My goal is to create a like engine with can handle millions of likes per second. Let it be 1 like for 1 article/URL or 1000 likes for 1000 articles/URLs or 1 article/URL with million likes.
            </div>
        </div>
    </a>
</div>

            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/projects/engines/" class="d-block"><div class="card-body">
            <h4 class="card-title">Code Challenges and Solutions</h4>
            <p class="card-text text-muted text-uppercase">November 26, 2016</p>
            <div class="card-text">
                Challenges and Solutions
            </div>
        </div>
    </a>
</div>

            </div></div>
    <footer>
        <script src="https://giscus.app/client.js"
    data-repo="krishnakumar4a4/krishnakumar4a4.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkxMDA3OTMxMTU="
    data-category="Blog Comments"
    data-category-id="DIC_kwDOBgH7G84CUoxF"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light_high_contrast"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
  </script>
  <br/>
  <div style="border: 2px solid black; 
  border-radius: 5px; padding: 2px 5px 0px 5px;
  width: fit-content; 
  margin-left: auto; margin-right: 0;">
    <p style="text-align: right">
    <span style="font-family: sans-serif;font-size: 14px;"> Alternatively, you can  </span>
    <button style="background:#055d20;
    font-size: 14px;display: inline-block;
    border-bottom-color: #013d14;
    font-family: sans-serif;
    font-weight: 400;
    color:white;
    border-radius: 5px" onclick="window.location.href = 'https://github.com/krishnakumar4a4/krishnakumar4a4.github.io/discussions/categories/blog-comments';">
    Comment directly on Github Discussion
    </button>
    <br/>
    <span style="font-family: sans-serif;font-size: 14px;"><span>#️⃣</span>
    <span style="color: #055d20">Be on your best Erlang behavior</span>
    </span>
    </p>
  </div>
    </footer>
</main>


    <footer class="footer text-center bg-dark py-6">
    <div class="container">
        <div class="row">
            <div class="col">
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="https://krishnakumar4a4.github.io/index.xml" rel="alternate" type="application/rss+xml" class="icons d-block">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a></li><li class="list-inline-item">
                        <a href="mailto:krishna.thokala2010@gmail.com" class="icons d-block">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li><li class="list-inline-item">
                            <a href="https://github.com/krishnakumar4a4" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://keybase.io/krishnakumart" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-keybase fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.linkedin.com/in/krishnakumarthokala/" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://fsmi.social/krishnakumart" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://krishnakumart.medium.com/" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-medium fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://reddit.com/u/krishnakumart" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-reddit fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://twitter.com/KrishnaKumarT36" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                </ul>

                <p class="text-muted">
                    
                        Copyright &copy; Krishna Kumar T 2023
                    
                </p>

                <p class="text-muted">
                Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with <a href="https://github.com/puresyntax71/hugo-theme-chunky-poster" target="_blank">Chunky Poster</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

    
    
        
            <script src="/dist/main.d608eadfe5ac0688902e.min.js"></script>
        
    



<script>
    window.Prism = window.Prism || {};
    window.Prism.manual = true;
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js"></script>






    
</body>
</html>
