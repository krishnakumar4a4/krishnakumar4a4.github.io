<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>
  
     Beauty and mystery of Erlang distribution | 
    Krishna Kumar T
  
</title><meta name="description" content="Beauty and mystery of Erlang distribution"><meta name="author" content="Krishna Kumar Thokala">

<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/favicon-32x32.png " sizes="32x32" type="image/png">
<link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0c344b">
<link rel="icon" href="/favicon.ico">


    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism-okaidia.min.css">
    



    
        
            <link rel="stylesheet" href="/dist/main.37ab3f61b95417873748.min.css">
        
    




<link rel="canonical" href="https://krishnakumar4a4.github.io/post/beauty-mystery-erlang-distribution/"><meta property="og:title" content="Beauty and mystery of Erlang distribution" />
<meta property="og:description" content="Beauty and mystery of Erlang distribution" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://krishnakumar4a4.github.io/post/beauty-mystery-erlang-distribution/" />
<meta property="article:published_time" content="2016-08-14T09:43:12&#43;05:30"/>
<meta property="article:modified_time" content="2016-08-14T09:43:12&#43;05:30"/><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/speakup-announcement/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/comparision-erlang-and-rust/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/simplifying-erlang-beam/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/react-redux-erlang-analogy/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/be-on-your-best-erlang-behavior/" /><meta property="og:see_also" content="https://krishnakumar4a4.github.io/post/know-why-you-may-choose-erlang/" />


<meta itemprop="name" content="Beauty and mystery of Erlang distribution">
<meta itemprop="description" content="Beauty and mystery of Erlang distribution">


<meta itemprop="datePublished" content="2016-08-14T09:43:12&#43;05:30" />
<meta itemprop="dateModified" content="2016-08-14T09:43:12&#43;05:30" />
<meta itemprop="wordCount" content="756">



<meta itemprop="keywords" content="erlang," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Beauty and mystery of Erlang distribution"/>
<meta name="twitter:description" content="Beauty and mystery of Erlang distribution"/>

</head>
<body>
    
<nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id="navbar-main-menu">
    <div class="container">
        <a class="navbar-brand font-weight-bold" href="https://krishnakumar4a4.github.io">Krishna Kumar T</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="main-menu">
            <ul class="navbar-nav ml-auto">
                
                    <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/project-updates/">Project Updates</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/github-projects/">Github Projects</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/post/">Posts</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/tweets/">Tweets</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/linkedin-posts/">LinkedIn Posts</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/team/">Team</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/tags/">Tags</a></li>
                
            
            </ul>
        </div>
    </div>
</nav>


    
<main class="content-page container pt-7 pb-5">
    
    <div class="row">
        <div class="col">
            <article>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="meta text-muted mb-3">
                            <p class="created text-muted text-uppercase font-weight-bold mb-1">August 14, 2016</p>
                            <span class="mr-2"><i class="fas fa-book-open mr-2"></i>756 words</span>
                            <span><i class="fas fa-clock mr-2"></i>4 mins read</span>
                        </div>

                        <h1>Beauty and mystery of Erlang distribution</h1>

                        <ul class="authors list-inline"><li class="list-inline-item mr-3">
                    <div class="media author"><a href="/authors/krishna-kumar-thokala/" class="mr-3">
                                    <picture>
                                        <source srcset="/authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_64x0_resize_box_2.png 1x, /authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_128x0_resize_q100_box_2.png 2x, /authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_192x0_resize_q100_box_2.png 3x">
                                        <img src="/authors/krishna-kumar-thokala/krishnakumart_hu508b74bb11feca0be536ac3c830fb287_817534_64x0_resize_box_2.png" class="rounded-circle" alt="Krishna Kumar Thokala">
                                    </picture>
                                </a><div class="media-body">
                            <h5 class="name my-0"><a href="/authors/krishna-kumar-thokala/" class="small">Krishna Kumar Thokala</a>
                            </h5><p class="social small text-muted">
                                    <a href="https://twitter.com/@krishnakumart36">@KrishnaKumarT36</a>
                                </p></div>
                    </div>
                </li></ul>
                    </div>
                </div><div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="content">
                            

<p>I work on a network element simulator written in Erlang. For us, each network element is a bunch of Erlang processes work together to simulate a network element and we are simulating tens and hundreds of them on each Erlang node. We also run a distributed network of erlang nodes which all together renders some thousands of network elements running on one Linux machine.</p>

<p>Done with background!!</p>

<h4 id="the-problem">The problem:</h4>

<p>We are not able to start more than 250 Erlang nodes on one Linux machine provided we have enough resources to start more of them, and thus limiting our network element count beyond some value.</p>

<h4 id="digged-in">Digged in:</h4>

<p>My job was to find out why it was limited and increase it by any means possible.</p>

<p>I once read in Erlang system limitations document that Erlang distribution is limited by the availability of sockets on the machine.</p>

<p>Each socket is a combination of an IP and port. So for each IP, I can start a maximum of 65536 sockets as the number of ports(65536) is fixed on any machine.</p>

<p>When one Erlang node is started, one random port is chosen on the local host(127.0.0.1) which would bind to epmd port(4369) on the same localhost. This epmd daemon will be started with the first Erlang node and will share connections(ESTABLISHED) to all the other random ports on 127.0.0.1 started for each Erlang node. It would also create one more listener on a random port of 0.0.0.0.</p>

<blockquote>
<p>Each and every erlang node maintains an established connection with the host EPMD daemon which is required for active distribution. This is a default behavior of distributed protocol.</p>
</blockquote>

<p>Now the mathematics, for &lsquo;n&rsquo; number of erlang nodes without any distributed connectivity between them will create &lsquo;n&rsquo; established connections on localhost which would occupy &lsquo;n&rsquo; ports and &lsquo;n&rsquo; listeners on 0.0.0.0 interface.</p>

<p>When we activate distribution by setting a common cookie for all and pinging on another. I could see &lsquo;n(n-1)’ established connections between all the Erlang nodes and all these utilized &lsquo;n(n-1)’ ports on the public ip of the machine.</p>

<p>So again mathematics, for &lsquo;n&rsquo; Erlang nodes started with distribution would utilize:
&gt;&lsquo;n&rsquo; ports for listeners on 0.0.0.0
&gt;&lsquo;n&rsquo; ports for established connections towards epmd on localhost(127.0.0.1)
&gt;&lsquo;n(n-1)’ ports for established connections on Public Ip for distribution</p>

<p>As described in the Erlang system limitations document, the maximum number of erlang nodes that can be started with distribution is based on the availability of sockets and which in turn limited to 65536 for each ip.</p>

<p>For &lsquo;n&rsquo; Erlang nodes, &lsquo;n&rsquo; sockets/ports are utilized for localhost and 0.0.0.0. But &lsquo;n(n-1)’ sockets/ports are utilized on the public IP. So, the limitation would be set by fastest growing attribute from the above, I.e the maximum number of sockets supported by public IP and it is equal to 65536.</p>

<p>So,from the theory above we can start at most 256 Erlang nodes with distribution. But when we take out some of the low level ports below 1000 and some system utilized ports. The Erlang node count would vary between 230–256 practically.</p>

<blockquote>
<p>I am thinking to draw a network connection graph between these Erlang nodes to visualize Erlang node/port cluster. But couldn’t find an easier way to do it. I will tag that too here once done.</p>
</blockquote>

<hr />

<h4 id="the-mini-solution">The mini solution:</h4>

<p>One of the solution I could think of was to start each Erlang node with ‘-hidden’ option, so that the clustering will be linear rather than having every node connected to every other node. Node1 is only connected to node 2 and node 2 is only connected to node 3. Here node 1 to node 3 connection will be eliminated.</p>

<p>Hence, practically I could see only ‘2n’ established connections between nodes which would be far less than the earlier &lsquo;n(n-1)’ philosophy.</p>

<blockquote>
<p>Note: This solution should be tested practically as this may cause some problems with distributed mnesia sync and other distributed features.</p>
</blockquote>

<p>Also found, inet_dist_listen_min and inet_dist_listen_max parameters as command line arguments to “erl” gives you flexibility to increase the port limit allowed for distribution.</p>

<p>When the erlang node count reaches beyond 200, finding a free port to start a newly distributed node will take much higher time. inet_tcp_dist module houses a mechanism to check port numbers one by one( between inet_dist_listen_min and inet_dist_listen_max) every time. As a result,all the lower port numbers are occupied first and hence increasing the time to find a higher free port number.</p>

<hr />

<blockquote>
<p><strong><em>Disclaimer</em></strong>: This article was written based on observation, I would like to refine things in the near future. Suggestions and corrections are welcome.</p>
</blockquote>

                        </div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href="/tags/erlang">
                                    <i class="fas fa-tag mr-2"></i>erlang
                                </a></div><ul class="share nav my-3 justify-content-end">
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbeauty-mystery-erlang-distribution%2f&text=Beauty%20and%20mystery%20of%20Erlang%20distribution">
              <i class="fa-fw fab fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbeauty-mystery-erlang-distribution%2f&title=Beauty%20and%20mystery%20of%20Erlang%20distribution">
                <i class="fa-fw fab fa-linkedin-in"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbeauty-mystery-erlang-distribution%2f&t=Beauty%20and%20mystery%20of%20Erlang%20distribution">
                <i class="fa-fw fab fa-facebook-f"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://reddit.com/submit?url=https%3a%2f%2fkrishnakumar4a4.github.io%2fpost%2fbeauty-mystery-erlang-distribution%2f&title=Beauty%20and%20mystery%20of%20Erlang%20distribution">
                <i class="fa-fw fab fa-reddit-alien"></i>
            </a>
        </li>
    </nav>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        
                    </div>
                </div></article>
        </div>
    </div>

    
    <footer>
        <script src="https://giscus.app/client.js"
    data-repo="krishnakumar4a4/krishnakumar4a4.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkxMDA3OTMxMTU="
    data-category="Blog Comments"
    data-category-id="DIC_kwDOBgH7G84CUoxF"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light_high_contrast"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
  </script>
  <br/>
  <div style="border: 2px solid black; 
  border-radius: 5px; padding: 2px 5px 0px 5px;
  width: fit-content; 
  margin-left: auto; margin-right: 0;">
    <p style="text-align: right">
    <span style="font-family: sans-serif;font-size: 14px;"> Alternatively, you can  </span>
    <button style="background:#055d20;
    font-size: 14px;display: inline-block;
    border-bottom-color: #013d14;
    font-family: sans-serif;
    font-weight: 400;
    color:white;
    border-radius: 5px" onclick="window.location.href = 'https://github.com/krishnakumar4a4/krishnakumar4a4.github.io/discussions/categories/blog-comments';">
    Comment directly on Github Discussion
    </button>
    <br/>
    <span style="font-family: sans-serif;font-size: 14px;"><span>#️⃣</span>
    <span style="color: #055d20">Beauty and mystery of Erlang distribution</span>
    </span>
    </p>
  </div>
    </footer>
</main>


    <footer class="footer text-center bg-dark py-6">
    <div class="container">
        <div class="row">
            <div class="col">
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="https://krishnakumar4a4.github.io/index.xml" rel="alternate" type="application/rss+xml" class="icons d-block">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a></li><li class="list-inline-item">
                        <a href="mailto:krishna.thokala2010@gmail.com" class="icons d-block">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li><li class="list-inline-item">
                            <a href="https://github.com/krishnakumar4a4" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://keybase.io/krishnakumart" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-keybase fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.linkedin.com/in/krishnakumarthokala/" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://fsmi.social/krishnakumart" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://krishnakumart.medium.com/" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-medium fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://reddit.com/u/krishnakumart" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-reddit fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://twitter.com/KrishnaKumarT36" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                </ul>

                <p class="text-muted">
                    
                        Copyright &copy; Krishna Kumar T 2023
                    
                </p>

                <p class="text-muted">
                Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with <a href="https://github.com/puresyntax71/hugo-theme-chunky-poster" target="_blank">Chunky Poster</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

    
    
        
            <script src="/dist/main.d608eadfe5ac0688902e.min.js"></script>
        
    



<script>
    window.Prism = window.Prism || {};
    window.Prism.manual = true;
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js"></script>






    
</body>
</html>
